<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="contact-links">
            <a href="mailto:sumhelp24@gmail.com">
                <img src="images/gmail.jpg" alt="Gmail">
            </a>
            
            <a href="https://t.me/+6281237611611" target="_blank">
                <img src="images/tlg.jpg" alt="Telegram">
            </a>
            
            <a href="#" onclick="getLocation(); return false;">
                <img src="images/polis.jpg" alt="Call Police">
            </a>
        </div>

        <div id="map"></div>
        <div class="emergency-number" id="emergencyNumber"></div>
    </div>
    <footer>
        <p>&copy; 2025 Sumba-island. All rights reserved.</p>
    </footer>

    <!-- PERBAIKAN 1: Tambahkan callback dan error handling untuk Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCsTaQOJoCMRHz7lIw8bBOWZQLflmeVBVo&callback=initMap&loading=async" async defer></script>

    <script>
        let map;
        let marker;

        // PERBAIKAN 2: Tambahkan fungsi initMap untuk inisialisasi dasar
        function initMap() {
            // Inisialisasi peta dengan koordinat default
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: -9.6500, lng: 120.2667 }, // Koordinat default Sumba
                zoom: 8
            });
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    showPosition,
                    showError,
                    { timeout: 10000 } // PERBAIKAN 3: Tambahkan timeout
                );
            } else {
                alert("Geolocation tidak didukung oleh browser ini.");
            }
        }

        function showPosition(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;

            // PERBAIKAN 4: Pastikan peta sudah terinisialisasi
            if (!map) initMap();

            // Update viewport ke lokasi pengguna
            map.setCenter({ lat, lng });
            map.setZoom(15);

            // Hapus marker lama jika ada
            if (marker) marker.setMap(null);
            
            // Buat marker baru
            marker = new google.maps.Marker({
                position: { lat, lng },
                map: map,
                title: "Lokasi Anda"
            });

            // PERBAIKAN 5: Gunakan textContent untuk keamanan
            const emergencyNumber = "+6281337116321";
            document.getElementById('emergencyNumber').textContent = 
                `Nomor Darurat Terdekat: ${emergencyNumber}`;
        }

        function showError(error) {
            // PERBAIKAN 6: Tambahkan error handling spesifik
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    alert("Izin lokasi ditolak. Aktifkan izin lokasi untuk melanjutkan.");
                    break;
                case error.TIMEOUT:
                    alert("Permintaan lokasi melebihi batas waktu.");
                    break;
                case error.POSITION_UNAVAILABLE:
                    alert("Informasi lokasi tidak tersedia.");
                    break;
                default:
                    alert("Terjadi kesalahan saat mengambil lokasi.");
            }
        }

        // PERBAIKAN 7: Handle error Google Maps API
        window.gm_authFailure = function() {
            alert("Gagal memuat Google Maps. Periksa koneksi internet atau API Key.");
        };
    </script>
</body>
</html>
        
